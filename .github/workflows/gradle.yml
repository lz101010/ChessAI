# SPDX-License-Identifier: MIT
# Copyright (c) 2022 Lukas Zeller

name: Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  gradle:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ‰ Start CI
      run: echo "ğŸ§ Triggered by ${{ github.event_name }} event, running on ${{ runner.os }}."

    - name: â¤µï¸ Check out repository code
      uses: actions/checkout@v2
      with:
        # Disabling shallow clone is recommended for improving relevancy of reporting
        fetch-depth: 0

    - name: ğŸ”§ Configure Java and Gradle
      uses: ./.github/actions/setup-java-gradle

    - name: ğŸ”¨ Run Gradle build
      run: ./gradlew build

    - name: âœ… Determine Test Coverage
      uses: ./.github/actions/test-coverage

    - name: ğŸ”ï¸ SonarQube Scan
      uses: ./.github/actions/sonar
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        sonar_token: ${{ secrets.SONAR_TOKEN }}
        sonar_host_url: ${{ secrets.SONAR_HOST_URL }}

    - name: ğŸš€ Finalize
      run: echo "ğŸ’š This job's status is ${{ job.status }}."
